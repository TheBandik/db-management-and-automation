# Установка и настройка СУБД

## Настольные, встраиваемые и серверные СУБД

### Настольные СУБД

Настольные СУБД — это набор различных средств и методов, которые предназначены для формирования, сопровождения и использования информационных баз данных. Используют в модели вычислений с сетью и файловым сервером.

Paradox, Microsoft Access, FoxPro, dBase и др.

Достоинства настольных СУБД:

+ Они являются простыми для освоения и использования
+ Обладают дружественным пользовательским интерфейсом
+ Ориентированы на класс ПК, на самую широкую категорию пользователей – непрофессионалов
+ Обеспечивают хорошее быстродействие при работе с небольшими БД

Недостатки настольных СУБД:

+ При росте объемов хранимых данных и увеличении числа пользователей снижается их производительность и могут возникать сбои при обработке данных
+ Контроль за целостностью совершается внутри пользовательского приложения, что может вызывать нарушение целостности данных
+ Очень малая эффективность работы в компьютерной сети


### Встраиваемые СУБД

Поставляются в составе готового программного продукта, не требуя процедуры самостоятельной установки. Предназначены для локального хранения данных приложения и не рассчитаны на коллективное использование в сети.

SQLite, Firebird Embedded, Microsoft SQL Server Compact

Достоинства встраиваемых СУБД:

+ Высокая скорость
+ Простота использования

Недостатки встраиваемых СУБД:

+ Не подходит для хранения больших массивов данных
+ Нет возможно работать нескольким пользователям
+ Безопасность

Пример работы на Python:

```python
import sqlite3

# Соединение с базой данных
conn = sqlite3.connect('test.db')

# Создание таблицы
conn.execute('''CREATE TABLE users
             (id INTEGER PRIMARY KEY,
             name TEXT,
             age INTEGER)''')

# Вставка данных в таблицу
conn.execute("INSERT INTO users (name, age) VALUES ('John', 25)")
conn.execute("INSERT INTO users (name, age) VALUES ('Jane', 30)")
conn.execute("INSERT INTO users (name, age) VALUES ('Bob', 40)")

# Сохранение изменений
conn.commit()

# Выборка данных из таблицы
cursor = conn.execute("SELECT id, name, age FROM users")
for row in cursor:
    print(row)

# Закрытие соединения с базой данных
conn.close()
```

### Серверные СУБД

Вся обработка данных ведётся в одном месте, на сервере, в том же месте, где хранятся (обычно) данные. К файлам данных имеет доступ только один сервер, одна система — это сама СУБД. Приложения-клиенты посылают запросы на обработку и получение данных из СУБД и получают ответы. Приложения-клиенты не имеют непосредственного доступа к файлам данных.

Microsoft SQL Server, Oracle, Firebird, PostgreSQL, InterBase, MySQL и др.

Достоинства серверных СУБД:

+ Быстродействие, надежность и удобство хранения данных любого объема
+ Наличие встроенных алгоритмов анализа данных
+ Наличие инструментов полнотекстового поиска
+ Наличие инструментов репликации данных
+ Снижение нагрузки на клиентское устройство

Недостатки серверных СУБД:

+ Высокая стоимость корпоративных версий СУБД
+ Повышение нагрузки на сервер приложений
+ Относительная сложность эксплуатации серверной части СУБД

#### Установка

##### Хостинг

На любом хостинге с поддержкой СУБД база поднимается автоматически.

##### Windows

1. Скачайте установочный файл MySQL Community Server с официального сайта MySQL (https://dev.mysql.com/downloads/mysql/)
2. Запустите установочный файл и следуйте инструкциям мастера установки
3. В процессе установки вы можете выбрать тип установки (стандартная или пользовательская), настройки безопасности, порт для подключения к серверу MySQL и другие параметры
4. После завершения установки запустите MySQL Server из меню "Пуск" -> "MySQL" -> "MySQL Server X.X" (где X.X - версия MySQL)
5. Для подключения к серверу MySQL можно использовать консольный клиент mysql, который также должен быть установлен в процессе установки MySQL Community Server. Для запуска клиента откройте командную строку Windows и введите команду "mysql -u root -p", где "root" - имя пользователя по умолчанию, а "-p" указывает на необходимость ввода пароля для доступа к серверу
6. После входа в консольный клиент MySQL вы можете создавать базы данных, таблицы, выполнять запросы и другие операции с базами данных

##### XAMPP

1. Скачайте установочный файл XAMPP с официального сайта Apache Friends (https://www.apachefriends.org/ru/download.html)
2. Запустите установочный файл и следуйте инструкциям мастера установки. По умолчанию XAMPP устанавливается в папку C:\xampp
3. После завершения установки запустите панель управления XAMPP из меню "Пуск" -> "XAMPP" -> "XAMPP Control Panel"
4. В панели управления XAMPP можно запустить и остановить серверы Apache и MySQL, а также настроить их параметры и настройки
5. Для запуска сервера Apache отметьте галочку напротив его названия и нажмите на кнопку "Start"
6. Для проверки работы сервера Apache введите в адресной строке браузера адрес "http://localhost/".
7. Для доступа к файлам и директориям на сервере Apache откройте папку "htdocs", которая находится в папке установки XAMPP (по умолчанию C:\xampp\htdocs). В этой папке можно создавать свои файлы и директории, которые будут доступны через сервер Apache
8. Для доступа к базе данных MySQL откройте браузер и введите адрес "http://localhost/phpmyadmin/". В phpMyAdmin можно создавать базы данных, таблицы, выполнять запросы и другие операции с базами данных
9. По умолчанию XAMPP настроен на работу с портом 80 для сервера Apache и портом 3306 для базы данных MySQL. Если эти порты уже используются другими приложениями на вашем компьютере, то можно изменить их на другие в панели управления XAMPP

##### Linux

1. Откройте терминал и выполните команду sudo apt update для обновления списка пакетов
2. Затем выполните команду sudo apt install mysql-server для установки сервера MySQL
3. Во время установки вам будет предложено ввести пароль для учетной записи root MySQL. Введите пароль и подтвердите его
4. После установки запустите сервер MySQL командой sudo systemctl start mysql. Эта команда также запустит службу MySQL при загрузке системы
5. Проверьте статус сервера MySQL, выполнив команду sudo systemctl status mysql. Если сервер работает, вы увидите сообщение "active (running)"
6. Теперь вы можете подключиться к серверу MySQL и начать работать с базами данных. Для подключения используйте команду mysql -u root -p, где "-u root" указывает имя пользователя (root) и "-p" указывает на необходимость ввода пароля
7. Если вы хотите настроить MySQL, изменить параметры или создать новых пользователей, можно использовать утилиту mysql_secure_installation, которая установится вместе с сервером MySQL.

##### Docker

1. Установите Docker на вашу систему
2. Откройте терминал и выполните команду docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:latest. Эта команда загрузит последнюю версию образа MySQL из Docker Hub, создаст новый контейнер и запустит его. Параметр "--name" задает имя контейнера, "-e MYSQL_ROOT_PASSWORD" устанавливает пароль для учетной записи root в MySQL
3. Проверьте статус контейнера, выполнив команду docker ps -a. Если контейнер работает, вы увидите его имя и статус "Up" в списке контейнеров
4. Теперь вы можете подключиться к серверу MySQL в контейнере и начать работать с базами данных. Для подключения используйте команду docker exec -it some-mysql mysql -u root -p, где "some-mysql" - имя контейнера, "-u root" указывает имя пользователя (root) и "-p" указывает на необходимость ввода пароля
5. Если вы хотите остановить или удалить контейнер, выполните команды docker stop some-mysql и docker rm some-mysql соответственно

#### Создание пользователя

1. Подключитесь к серверу MySQL в терминале или в интерфейсе командной строки, используя учетную запись администратора (например, root)
2. Выполните команду CREATE USER 'username'@'localhost' IDENTIFIED BY 'password';, где 'username' - имя пользователя, которое вы хотите создать, 'localhost' - имя хоста, с которого пользователь будет подключаться к серверу MySQL (в данном случае, это локальный хост), 'password' - пароль для этого пользователя
3. Если вы хотите, чтобы пользователь мог подключаться к серверу MySQL с любого хоста, замените 'localhost' на '%', например: CREATE USER 'username'@'%' IDENTIFIED BY 'password';
4. Для назначения прав доступа для нового пользователя выполните команду GRANT ALL PRIVILEGES ON *.* TO 'username'@'localhost';. Эта команда предоставляет пользователю 'username' все привилегии для всех баз данных и таблиц в MySQL на локальном хосте
5. Если вы хотите разрешить пользователю доступ к MySQL с любого хоста, замените 'localhost' на '%', например: GRANT ALL PRIVILEGES ON *.* TO 'username'@'%';
6. Чтобы применить изменения, выполните команду FLUSH PRIVILEGES;

#### Создание пользователя с возможностью удаленного подключения

# Настройки безопасности баз данных

## Безопасная установка MySQL

+ Установка в защищенном окружении
+ Установка пароля на root
+ Отключение удаленного подключения к root

## Отключить LOCAL INFILE в MySQL

В рамках усиления безопасности необходимо отключить local-infile, чтобы предотвратить доступ к базовой файловой системе из MySQL, используя следующую директиву в разделе [mysqld].

```
# Путь
/etc/mysql/mysql.conf.d/mysqld.cnf [Debian/Ubuntu]
```

```
local-infile=0
```

## Измените порт MYSQL по умолчанию

Переменная Port устанавливает номер порта MySQL, который будет использоваться для прослушивания соединений TCP/IP. Номер порта по умолчанию – 3306, но вы можете изменить его в разделе [mysqld], как показано.

```
Port=1313
```

## Включить ведение журнала MySQL

Журналы — это один из лучших способов понять, что происходит на сервере, в случае любых атак вы можете легко увидеть любые действия, связанные с вторжением, из файлов журналов. Вы можете включить ведение журнала MySQL, добавив следующую переменную в разделе [mysqld].

```
log=/var/log/mysql.log
```

## Удалить историю оболочки MySQL

Все команды, которые вы выполняете в оболочке MySQL, хранятся клиентом mysql в файле истории: ~/.mysql_history. Это может быть опасно, поскольку для любых создаваемых вами учетных записей все имена пользователей и пароли, введенные в оболочке, будут записаны в файл истории.

```
cat /dev/null > ~/.mysql_history
```

## Не вводить пароль в командной строке

Так вот не надо:

```
mysql -u root -ppassword_
```

Надо вот так:

```
mysql -u root -p
```

## Определите пользователей базы данных приложения

Для каждого приложения, работающего на сервере, предоставьте доступ только пользователю, который отвечает за базу данных для данного приложения. Например, если у вас есть сайт WordPress, создайте определенного пользователя для базы данных сайта WordPress следующим образом.

```sql
CREATE DATABASE wordpress_db;
REATE USER 'wordpress'@'localhost' IDENTIFIED BY 'wordpress@dmin%!2';
GRANT ALL PRIVILEGES ON wordpress_db.* TO 'wordpress'@'localhost';
FLUSH PRIVILEGES;
exit
```

и не забывайте всегда удалять учетные записи пользователей, которые больше не управляют какой-либо базой данных приложений на сервере.

## Регулярно меняйте пароли MySQL

```sql
USE mysql;
UPDATE user SET password=PASSWORD('YourPasswordHere') WHERE User='root' AND Host = 'localhost';
FLUSH PRIVILEGES;
```

## Общие рекомендации

+ Никогда не давайте никому (кроме учетной записи MySQL root) доступ к таблице user в базе mysql
+ Не храните пароли открытого текста в своей базе данных. Злоумышленник может взять полный список паролей и использовать их. Вместо этого используйте SHA2(), SHA1(), MD5() или некоторую другую одностороннюю хеширующую функцию и храните значение хеша.

## Привелегии

+ CREATE
+ DROP
+ GRANT OPTION
+ LOCK TABLES
+ REFERENCES
+ EVENT
+ ALTER
+ DELETE
+ INDEX
+ INSERT
+ SELECT
+ UPDATE
+ CREATE TEMPORARY TABLES
+ TRIGGER
+ CREATE VIEW
+ SHOW VIEW
+ ALTER ROUTINE
+ CREATE ROUTINE
+ EXECUTE
+ FILE
+ CREATE TABLESPACE
+ CREATE USER
+ CREATE ROLE
+ DROP ROLE
+ PROCESS
+ PROXY
+ RELOAD
+ REPLICATION CLIENT
+ REPLICATION SLAVE
+ SHOW DATABASES
+ SHUTDOWN
+ SUPER
+ ALL
+ USAGE
